<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>It on 低质量随笔</title>
    <link>https://kyzy540.github.io/tags/it/</link>
    <description>Recent content in It on 低质量随笔</description>
    <generator>Hugo -- 0.152.2</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 03 Dec 2025 16:55:28 +0800</lastBuildDate>
    <atom:link href="https://kyzy540.github.io/tags/it/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>如何中断Taskflow工作流</title>
      <link>https://kyzy540.github.io/post/taskflow_stop_a_flow/</link>
      <pubDate>Wed, 03 Dec 2025 16:55:28 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/taskflow_stop_a_flow/</guid>
      <description>&lt;p&gt;taskflow的poster+conductor架构下，conductor以多线程并发运行job。线程池被封装在内部。因此一旦conductor开始执行任务，想中断它就很麻烦。通常要重启整个conductor线程池&lt;/p&gt;
&lt;p&gt;是否有更优雅的办法中断conductor正在执行的任务？&lt;/p&gt;
&lt;h2 id=&#34;不可行jobboardabandontrash&#34;&gt;不可行——JobBoard.abandon()/trash()&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;JobBoard&lt;/code&gt;的&lt;code&gt;abandon&lt;/code&gt;和&lt;code&gt;trash&lt;/code&gt;方法不能终止job。前者只删除job.lock，后者会把job数据拷贝到&lt;code&gt;/taskflow/.trash/&lt;/code&gt;下再删除job node。二者都没解决核心问题: 阻止工作流继续执行下一步骤。&lt;/p&gt;
&lt;h2 id=&#34;不推荐修改数据库atomdetails状态&#34;&gt;不推荐——修改数据库atomdetails状态&lt;/h2&gt;
&lt;p&gt;设想: 修改taskflow persistence数据库(如postresql) &lt;code&gt;flowdetails&lt;/code&gt;和&lt;code&gt;atomdetails&lt;/code&gt;表。把&lt;code&gt;RUNNING&lt;/code&gt;和&lt;code&gt;PENDING&lt;/code&gt;的步骤都UPDATE成&lt;code&gt;REVERTED&lt;/code&gt;。期望工作流在进入下一个task时会异常自动中断&lt;/p&gt;
&lt;p&gt;测试结果: taskflow会检查任务状态 &lt;strong&gt;合法性&lt;/strong&gt;。一个步骤&lt;code&gt;SUCCESS&lt;/code&gt;，但后续步骤状态是&lt;code&gt;FAILURE&lt;/code&gt;或&lt;code&gt;REVERTED&lt;/code&gt;会被识别为状态非法。这会导致conductor异常退出，影响其他线程。此外，taskflow会将失败任务的&lt;code&gt;failure&lt;/code&gt;字段转换成&lt;code&gt;dict&lt;/code&gt;。写入的数据结构必须也合法，否则任务无法被重试&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://docs.openstack.org/taskflow/latest/_images/task_states.svg&#34;&gt;&lt;/p&gt;
&lt;p&gt;同理state设为&lt;code&gt;REVERT_FAILURE&lt;/code&gt;或&lt;code&gt;SUCCESS&lt;/code&gt;可以中断工作流，但也会报错状态非法&lt;/p&gt;
&lt;p&gt;总之方案可行，但不高效&lt;/p&gt;
&lt;h2 id=&#34;可行kill-conductor进程&#34;&gt;可行——kill conductor进程&lt;/h2&gt;
&lt;p&gt;每个conductor都只维护一个线程，在更上层用 &lt;strong&gt;进程&lt;/strong&gt; 维护多个conductor。这样就可通过kill conductor进程。但代价是任务的&lt;code&gt;revert&lt;/code&gt;方法不会被执行。如果所有任务完全幂等，没有资源泄漏风险，是可行的&lt;/p&gt;
&lt;p&gt;但不推荐这个方案。它实际上提高了任务设计难度，也不符合taskflow的设计理念&lt;/p&gt;
&lt;h2 id=&#34;推荐execute装饰器&#34;&gt;推荐——execute()装饰器&lt;/h2&gt;
&lt;p&gt;示例代码如下&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; threading &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; Event
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; taskflow &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; task
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cancel_event &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Event()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CancelableTask&lt;/span&gt;(task&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Task):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;__init_subclass__&lt;/span&gt;(cls, &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init_subclass__(&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; hasattr(cls, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;execute&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; callable(cls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;execute):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            original_execute &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;execute
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;wrapped_execute&lt;/span&gt;(self, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;args, &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; cancel_event &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; cancel_event&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;is_set():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Exception&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Flow cancelled at start&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; original_execute(self, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;args, &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; cancel_event &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; cancel_event&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;is_set():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Exception&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Flow cancelled after execution&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; result
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            cls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;execute &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; wrapped_execute
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DownloadTask&lt;/span&gt;(CancelableTask):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;execute&lt;/span&gt;(self, url, &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Downloading &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;url&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Progress: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;i&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;%&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Downloaded &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;url&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;revert&lt;/span&gt;(self, result, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;args, &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;kwargs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;pass&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# TODO 清理工作&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;__init_subclass__&lt;/code&gt;是Python 3.6引入的特性，在子类初始化时执行。赋予父类修改子类方法的能力。示例代码中，&lt;code&gt;DownloadTask&lt;/code&gt;继承了&lt;code&gt;CancelableTask&lt;/code&gt;，它的&lt;code&gt;execute&lt;/code&gt;方法被 &lt;strong&gt;透明&lt;/strong&gt; 地封装了一层装饰器。如果检测到&lt;code&gt;cancel_event&lt;/code&gt;会抛出异常。这种抛异常方式是taskflow可以处理的，&lt;code&gt;DownloadTask&lt;/code&gt;的&lt;code&gt;revert&lt;/code&gt;方法随后会被调用，完成清理工作&lt;/p&gt;</description>
    </item>
    <item>
      <title>Taskflow自定义Conductor</title>
      <link>https://kyzy540.github.io/post/taskflow_inherit_conductor/</link>
      <pubDate>Wed, 03 Dec 2025 13:44:42 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/taskflow_inherit_conductor/</guid>
      <description>&lt;p&gt;Taskflow原生的 &lt;code&gt;blocking/nonblocking&lt;/code&gt; Conductor不支持Job过滤，也就是无差别消费所有Job。如果要实现特殊Job特殊Conductor处理，需要自定义Conductor&lt;/p&gt;
&lt;p&gt;什么Job算特殊？例如有某个工作流需要GPU资源，而Conductor集群里只有个别机器有GPU。此时最好的调度策略是有GPU的机器运行GPU Job。如果GPU机器空闲且其他机器忙，也可以运行不需要GPU的Job&lt;/p&gt;
&lt;h2 id=&#34;过滤job&#34;&gt;过滤Job&lt;/h2&gt;
&lt;p&gt;Conductor重载&lt;code&gt;_can_claim_more_jobs&lt;/code&gt;即可过滤Job。下面代码的&lt;code&gt;has_gpu&lt;/code&gt;没实现，仅用于说明逻辑: 无GPU的机器不会执行需要GPU的Job；有GPU的机器会执行所有Job&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; taskflow.conductors.backends.impl_nonblocking &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; NonBlockingConductor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GpuConductor&lt;/span&gt;(NonBlockingConductor):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;has_gpu&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;pass&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# TODO 获取GPU状态&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_can_claim_more_jobs&lt;/span&gt;(self, job):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; super()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;_can_claim_more_jobs(job):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gpu &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; job&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;details&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gpu&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; gpu &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;has_gpu():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;stevedore&#34;&gt;stevedore&lt;/h2&gt;
&lt;p&gt;Taskflow实例化Conductor依赖 &lt;a href=&#34;https://github.com/openstack/taskflow/blob/master/taskflow/conductors/backends/__init__.py#L36&#34;&gt;stevedore.driver.DriverManager&lt;/a&gt;，其基于命名空间和entry point在运行时加载Conductor。因此&lt;code&gt;GpuConductor&lt;/code&gt;必须添加到&lt;code&gt;taskflow.conductors&lt;/code&gt;命名空间下。推荐写&lt;code&gt;pyproject.toml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;project&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;entry-points&lt;/span&gt;.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;taskflow.conductors&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;gpu&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;custom_conductor.gpu_conductor:GpuConductor&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;编辑安装包&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install -e .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意，必须安装后stevedore才能在环境的分发元数据里发现新的entry point。直接跑源代码而不安装，stevedore看不到&lt;/p&gt;
&lt;p&gt;安装验证&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; stevedore.extension &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; ExtensionManager
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;em &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ExtensionManager(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;taskflow.conductors&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print([e&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;name &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; e &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; em&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;extensions]) &lt;span style=&#34;color:#75715e&#34;&gt;# 应包含 &amp;#34;gpu&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注册entry point不影响修改源代码，即修改&lt;code&gt;GpuConductor&lt;/code&gt;代码不需要重新安装&lt;/p&gt;
&lt;h2 id=&#34;job-post&#34;&gt;Job post&lt;/h2&gt;
&lt;p&gt;发布Job时，需要指定&lt;code&gt;details&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;job_backend &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; job_backends&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fetch(name, conf, persistence&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;persist_backend)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;details &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gpu&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;job_backend&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;post(flow_name, logbook, details)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    <item>
      <title>Siri接大模型唠嗑</title>
      <link>https://kyzy540.github.io/post/ios_shortcut_chatai/</link>
      <pubDate>Wed, 12 Nov 2025 10:58:24 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/ios_shortcut_chatai/</guid>
      <description>&lt;h2 id=&#34;简介&#34;&gt;简介&lt;/h2&gt;
&lt;p&gt;创建一个快捷指令供Siri使用。快捷指令会循环听用户问题，通过API发给大模型，后朗读回答。可以多轮问答，包含上下文&lt;/p&gt;
&lt;p&gt;API使用阿里云，可以改成其他兼容OpenAI标准的&lt;/p&gt;
&lt;p&gt;必须提供API Key。&lt;strong&gt;不免费&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;用法&#34;&gt;用法&lt;/h2&gt;
&lt;p&gt;下载快捷指令: &lt;a href=&#34;https://www.icloud.com/shortcuts/fc956f86a62044e08a9c89bec49e6be8&#34;&gt;唠嗑&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;将&lt;code&gt;Bearer sk-xxx&lt;/code&gt;替换成有效的 API Key 就可以使用了。获取key方法参考官方文档&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://api-docs.deepseek.com/zh-cn/&#34;&gt;DeepSeek&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://platform.moonshot.cn/docs/introduction#%E8%8E%B7%E5%8F%96-api-%E5%AF%86%E9%92%A5&#34;&gt;Moonshot AI (Kimi)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bailian.console.aliyun.com/?tab=api#/api/?type=model&amp;amp;url=2712195&#34;&gt;阿里云&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以下参数可以按需调整&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;model_name&lt;/code&gt;: 模型名，默认&lt;code&gt;qwen-flash&lt;/code&gt;。用 DeepSeek API 改成 &lt;code&gt;deepseek-chat&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;URL&lt;/code&gt;: 兼容OpenAI API标准的base_url。DeepSeek是&lt;code&gt;https://api.deepseek.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;重复&lt;code&gt;3&lt;/code&gt;次: 控制问答轮次，默认最多3轮。控制轮次是为了节约Token。由于问答包含上下文，轮次越多携带上下文越多，Token消耗越多&lt;/li&gt;
&lt;li&gt;&lt;code&gt;enable_search: True&lt;/code&gt;: 允许模型推理过程中联网，默认开启。模型更好回答时效性问题。代价是会多消耗些许Token&lt;/li&gt;
&lt;li&gt;prompt &lt;code&gt;Answer briefly, under 40 words&lt;/code&gt;: 提示词。限制回答字数。提示词也算Token，其本身不建议写长&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;费用&#34;&gt;费用&lt;/h2&gt;
&lt;p&gt;价格请以服务商官网实时报价为准。这里介绍算法。以2025-11-12阿里云&lt;code&gt;qwen-flash&lt;/code&gt;报价为例&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;单次请求的输入Token数&lt;/th&gt;
          &lt;th&gt;输入单价（每千Token）&lt;/th&gt;
          &lt;th&gt;输出单价（每千Token）&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;0&amp;lt;Token≤128K&lt;/td&gt;
          &lt;td&gt;0.00015元&lt;/td&gt;
          &lt;td&gt;0.00015元&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;128K&amp;lt;Token≤256K&lt;/td&gt;
          &lt;td&gt;0.0006元&lt;/td&gt;
          &lt;td&gt;0.006元&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;256K&amp;lt;Token≤1M&lt;/td&gt;
          &lt;td&gt;0.0012元&lt;/td&gt;
          &lt;td&gt;0.012元&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;1个Token通常对应一个汉字，或一个英语单词。看起来不贵，但实际计费不仅按问题的字数算，还有提示词、搜索网络等其他计费项&lt;/p&gt;
&lt;p&gt;如果觉得不好算，实践更直观。为了确保不少算，我把提示词限制升到80: &lt;code&gt;Answer briefly, under 80 words&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;3轮问答消耗消耗11K Tokens。输出10.5K, 输入0.5K。请求Token数匹配最低档位，花费 0.0015 * 10.5 + 0.00015 * 0.5 = 0.015825元&lt;/p&gt;</description>
    </item>
    <item>
      <title>删除ROG奥创中心手柄映射配置</title>
      <link>https://kyzy540.github.io/post/rog_armory_crate_template/</link>
      <pubDate>Sat, 01 Nov 2025 21:44:47 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/rog_armory_crate_template/</guid>
      <description>&lt;p&gt;ROG的奥创中心可以为每个游戏设独立的键位映射，但有个缺陷: 每个游戏的映射都会被保存下来，罗列在映射模版列表里。该如何删除自定义映射模版?&lt;/p&gt;
&lt;p&gt;先找到模版文件目录&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\MyName\AppData\Local\Packages\B9ECED6F.ArmouryCrateSE_qmba6cd70vzyy\LocalState\GamepadCustomize
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中&lt;code&gt;MyName&lt;/code&gt;是本地用户名。&lt;code&gt;B9ECED6F.ArmouryCrateSE_qmba6cd70vzyy&lt;/code&gt;前后两串码我不确定是否随机，反正中间&lt;code&gt;ArmouryCrateSE&lt;/code&gt;是一定的&lt;/p&gt;
&lt;p&gt;目录的&lt;code&gt;Profiles&lt;/code&gt;和&lt;code&gt;Templates&lt;/code&gt;里有若干&lt;code&gt;&amp;lt;uuid&amp;gt;.json&lt;/code&gt;文件，里面包含了模版名。删除json文件即可&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;，模版文件一式两份，两个目录下都要删除&lt;/p&gt;</description>
    </item>
    <item>
      <title>Mermaid图展示Python类方法重载</title>
      <link>https://kyzy540.github.io/post/python_overload_mermaid/</link>
      <pubDate>Sat, 01 Nov 2025 10:51:28 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/python_overload_mermaid/</guid>
      <description>&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GrandParent&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;show&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GrandParent show&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;age()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age: 60&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Parent&lt;/span&gt;(GrandParent):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;show&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Parent show&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age: 40&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Child&lt;/span&gt;(Parent):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;show&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Child show&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;@classmethod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Age: 20&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; __name__ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;__main__&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Child&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的python代码输出&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Child show
Parent show
GrandParent show
Age: 20
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解释一下。虽然在 &lt;code&gt;GrandParent.show()&lt;/code&gt; 中调用的是 &lt;code&gt;cls.age()&lt;/code&gt;，但由于是在 &lt;code&gt;Child&lt;/code&gt; 上下文中执行，所以实际调用的是 &lt;code&gt;Child.age()&lt;/code&gt;，因此最终输出的是 &amp;ldquo;Age: 20&amp;rdquo; 而不是 &amp;ldquo;Age: 60&amp;rdquo;&lt;/p&gt;</description>
    </item>
    <item>
      <title>iTerm2 &#43; Ollama启用AI功能</title>
      <link>https://kyzy540.github.io/post/iterm2_ai_plugin/</link>
      <pubDate>Tue, 28 Oct 2025 17:36:04 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/iterm2_ai_plugin/</guid>
      <description>&lt;p&gt;iTerm2 3.5后提供了AI功能，有2种用法:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Command + Shift + .&lt;/code&gt;打开&lt;strong&gt;composer&lt;/strong&gt;，输入自然语言后&lt;code&gt;Command + y&lt;/code&gt;生成shell命令&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Command + Shift + y&lt;/code&gt;打开&lt;strong&gt;AI chat&lt;/strong&gt;，关联iterm2 session作为上下文，和大模型问答&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;自然语言生成shell命令挺方便，不用去浏览器打开大模型网站，提问、复制、粘贴。安装步骤不复杂，参考文章:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://voipnuggets.com/2024/11/29/maximize-productivity-with-iterm2-ai-features/&#34;&gt;《Maximize Productivity with iTerm2 AI Features with Ollama 100% free》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;也有别家文章介绍iTerm2 AI其他配法，例如输入API Key远程调用Dashscope。但我推荐Ollama，重点是数据安全&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ollama是开源软件，本地运行大模型，数据不会上传云端&lt;/li&gt;
&lt;li&gt;Ollama支持多个大模型，如llama、qwen、deepseek等，可自行选择&lt;/li&gt;
&lt;li&gt;除下载模型外，不依赖互联网&lt;/li&gt;
&lt;li&gt;100%免费&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当然，Ollama也非完美，有些功能没法用，例如&lt;code&gt;AI Completion&lt;/code&gt;也就是命令自动补全。但我毕竟最优先考虑数据安全和免费，功能缺点也就凑合了。退一步想，如果生成shell命令足够快，自动补没有也罢&lt;/p&gt;
&lt;p&gt;说完有的没的，聊具体安装。我基于上面博文做了些调整&lt;/p&gt;
&lt;p&gt;用brew安装iTerm2 AI Plugin和ollama更方便&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install --cask itermai
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install ollama
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 开机自启动&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew services start ollama
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Configure AI Models Manually&lt;/em&gt; 重点配置和文章一样，区别是模型选&lt;strong&gt;deepseek-coder:1.7b&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;API: Llama&lt;/p&gt;
&lt;p&gt;API URL: http://localhost:11434/api/chat&lt;/p&gt;
&lt;p&gt;Model: deepseek-coder:1.7b&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我测试了几个模型: qwen2.5:3b/codellama:7b/qwen2.5-coder:1.5b/qwen3:4b/deepseek-r1:1.5b/deepseek-coder:1.7b。 &lt;strong&gt;deepseek-coder:1.7b&lt;/strong&gt; 最好用。生成命令一般5秒左右，慢也不超过10秒。如上所说，快才好使，不然就开浏览器得了&lt;/p&gt;
&lt;p&gt;次优选是 &lt;em&gt;qwen2.5-coder:1.5b&lt;/em&gt;，10~20秒生成命令。deepseek-r1和qwen3默认启用thinking，耗时超过1分钟，iTerm2会超时报错 (我没找到禁用thinking的方法，也许禁用后性能会不一样)&lt;/p&gt;</description>
    </item>
    <item>
      <title>pyenv迁移uv</title>
      <link>https://kyzy540.github.io/post/pyenv_to_uv/</link>
      <pubDate>Thu, 15 May 2025 13:48:54 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/pyenv_to_uv/</guid>
      <description>&lt;p&gt;pyenv和uv是俩python工具，都可以管理版本。只不过后者还提供管理项目的功能。看他们github介绍可见一斑&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/pyenv/pyenv&#34;&gt;pyenv&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Simple Python version management&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/astral-sh/uv&#34;&gt;uv&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An extremely fast Python package and project manager, written in Rust.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;uv所谓的项目管理，包含构建、测试、发布等功能。传统软件工程的老几样。显然管辖范围比pyenv大。在uv之前python的项目管理工具还有poetry、pdm等。综合比较项目活跃度、易用性、性能后，uv是其中较好的一款工具&lt;/p&gt;
&lt;p&gt;关于项目管理不展开说，仅介绍如何从pyenv迁移到uv。这对开发者来说通常是绕不开的第一步&lt;/p&gt;
&lt;p&gt;如果有耐心，可以先看&lt;a href=&#34;https://docs.astral.sh/uv/getting-started/#using-uv-build&#34;&gt;uv官方文档&lt;/a&gt;。下面是实操&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;安装uv，在macos下用brew&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install uv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;进入项目目录，初始化项目&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uv init
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此时，uv会创建&lt;code&gt;.python-version&lt;/code&gt;、&lt;code&gt;main.py&lt;/code&gt;、&lt;code&gt;pyproject.toml&lt;/code&gt;等文件，和&lt;code&gt;.venv&lt;/code&gt;目录，对应未初始化的虚拟环境。对于已有项目的迁移，程序入口和 Python 版本通常已经明确，可以保留 &lt;code&gt;pyproject.toml&lt;/code&gt; 和 &lt;code&gt;.venv&lt;/code&gt;，其余删除&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;p&gt;编辑&lt;code&gt;pyproject.toml&lt;/code&gt;，指定python版本和pyenv一致&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;导入依赖包&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uv add -r requirements.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然导依赖只有一行命令，但它其实做了3件事: 用指定python版本真正初始化&lt;code&gt;.venv&lt;/code&gt;虚拟环境 -&amp;gt; 修改&lt;code&gt;pyproject.toml&lt;/code&gt;文件添加依赖 -&amp;gt; 安装依赖包。如果第一次运行且依赖多。这里可能会多花些时间&lt;/p&gt;
&lt;p&gt;顺带一提，uv是多线程装包，速度比pyenv+pip快得多&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;删除pyenv初始化配置，通常在&lt;code&gt;.zshrc&lt;/code&gt;等地方。记得 &lt;strong&gt;重启shell&lt;/strong&gt;。否则&lt;code&gt;source .venv/bin/activate&lt;/code&gt;可能会失效。这也是我放弃pyenv的原因之一。它可能引入冲突，难以排查&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#eval &amp;#34;$(pyenv init -)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#eval &amp;#34;$(pyenv virtualenv-init -)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;到这其实迁移已完成。为了方便，可以加点佐料&lt;/p&gt;
&lt;p&gt;&lt;em&gt;7. 安装direnv&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install direnv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;8. 启用direnv和python的oh-my-zsh插件&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# vi ~/.zshrc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plugins&lt;span style=&#34;color:#f92672&#34;&gt;=(&lt;/span&gt;... python direnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PYTHON_VENV_NAME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.venv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PYTHON_AUTO_VRUN&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;source $ZSH/oh-my-zsh.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;direnv方便自动设环境变量 (如&lt;code&gt;PYTHONPATH&lt;/code&gt;)，写在&lt;code&gt;.envrc&lt;/code&gt;里即可。python插件可以自动启用/退出虚拟环境，注意&lt;code&gt;PYTHON_VENV_NAME&lt;/code&gt;和&lt;code&gt;PYTHON_AUTO_VRUN&lt;/code&gt;，必须在&lt;code&gt;source $ZSH/oh-my-zsh.sh&lt;/code&gt;前声明&lt;/p&gt;</description>
    </item>
    <item>
      <title>brew 降级</title>
      <link>https://kyzy540.github.io/post/brew_downgrade/</link>
      <pubDate>Thu, 20 Feb 2025 14:05:23 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/brew_downgrade/</guid>
      <description>&lt;p&gt;参考: &lt;a href=&#34;https://stackoverflow.com/questions/3987683/homebrew-install-specific-version-of-formula&#34;&gt;Homebrew install specific version of formula?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;以&lt;a href=&#34;https://formulae.brew.sh/cask/alt-tab&#34;&gt;alt-tab&lt;/a&gt;为例，从7.20.0 (有bug会崩溃) 降级到7.19.1&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;打开 &lt;a href=&#34;https://formulae.brew.sh/cask/alt-tab&#34;&gt;https://formulae.brew.sh/cask/alt-tab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;跳转 &lt;a href=&#34;https://github.com/Homebrew/homebrew-cask/blob/0ef28d3335279b043b131ffd4d5cfb3759837912/Casks/a/alt-tab.rb&#34;&gt;Cask code on GitHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;点开 &lt;a href=&#34;https://github.com/Homebrew/homebrew-cask/commits/master/Casks/a/alt-tab.rb&#34;&gt;alt-tab.rb History&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;找到要目标版本 (要降低到的版本)，点&lt;code&gt;View code at this point&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;下载 &lt;a href=&#34;https://github.com/Homebrew/homebrew-cask/blob/cbdcf50a724cb180d1c64719d331c9b70d85eca5/Casks/a/alt-tab.rb&#34;&gt;alt-tab.rb 7.19.1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;控制台进alt-tab.rb所在目录，执行&lt;code&gt;brew rnstall alt-tab.rb&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;该方法虽然麻烦，但通用。如果软件预备了多版本，例如 &lt;a href=&#34;https://formulae.brew.sh/formula/mysql-client&#34;&gt;mysql-client&lt;/a&gt;，可以通过&lt;code&gt;brew install mysql-client@8.4&lt;/code&gt;切版本，相对方便&lt;/p&gt;</description>
    </item>
    <item>
      <title>Zsh on macOS</title>
      <link>https://kyzy540.github.io/post/zsh_on_mac/</link>
      <pubDate>Mon, 19 Aug 2024 10:18:44 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/zsh_on_mac/</guid>
      <description>&lt;p&gt;前些日换Mac电脑，发现迁移zsh的配置有点繁琐，整了好一阵才顺手。索性写个文档记录下&lt;/p&gt;
&lt;p&gt;先安装oh-my-zsh，和俩爱用的插件 (自动补全和高亮)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sh -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  git clone https://github.com/zsh-users/zsh-autosuggestions &lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;ZSH_CUSTOM&lt;span style=&#34;color:#66d9ef&#34;&gt;:-&lt;/span&gt;~/.oh-my-zsh/custom&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;/plugins/zsh-autosuggestions &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  git clone https://github.com/zsh-users/zsh-syntax-highlighting.git &lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;ZSH_CUSTOM&lt;span style=&#34;color:#66d9ef&#34;&gt;:-&lt;/span&gt;~/.oh-my-zsh/custom&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;/plugins/zsh-syntax-highlighting
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;再来个Dracula主题&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://github.com/dracula/zsh.git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mv zsh/dracula.zsh-theme &lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;ZSH_CUSTOM&lt;span style=&#34;color:#66d9ef&#34;&gt;:-&lt;/span&gt;~/.oh-my-zsh/custom&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;/themes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mv zsh/lib &lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;ZSH_CUSTOM&lt;span style=&#34;color:#66d9ef&#34;&gt;:-&lt;/span&gt;~/.oh-my-zsh/custom&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;/themes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;改&lt;code&gt;~/.zshrc&lt;/code&gt;，启用主题和插件，禁用自动更新 (自动更新影响shell启动速度)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ZSH_THEME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dracula&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;zstyle &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;:omz:update&amp;#39;&lt;/span&gt; mode disabled  &lt;span style=&#34;color:#75715e&#34;&gt;# disable automatic updates&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plugins&lt;span style=&#34;color:#f92672&#34;&gt;=(&lt;/span&gt;git history zsh-autosuggestions zsh-syntax-highlighting&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对于常用的&lt;code&gt;alias&lt;/code&gt;，参考&lt;code&gt;.zshrc&lt;/code&gt;备注，写到&lt;code&gt;${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/aliases.zsh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;同理，在&lt;code&gt;custom&lt;/code&gt;目录下写&lt;code&gt;pyenv.zsh&lt;/code&gt;初始化&lt;code&gt;pyenv&lt;/code&gt; (omz的pyenv插件不好使)。写&lt;code&gt;auth.zsh&lt;/code&gt; export 常用认证相关环境变量&lt;/p&gt;
&lt;p&gt;希望对每个命令都奏效的环境变量写到&lt;code&gt;~/.zshenv&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# read even when Zsh is launched to run a single command&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export COPYFILE_DISABLE&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# go&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export GOPATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$HOME&lt;span style=&#34;color:#e6db74&#34;&gt;/go&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$GOPATH&lt;span style=&#34;color:#e6db74&#34;&gt;/bin:&lt;/span&gt;$PATH&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;参考: &lt;a href=&#34;https://unix.stackexchange.com/questions/71253/what-should-shouldnt-go-in-zshenv-zshrc-zlogin-zprofile-zlogout&#34;&gt;What should/shouldn&amp;rsquo;t go in .zshenv, .zshrc, .zlogin, .zprofile, .zlogout?&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>macOS安装v2ray客户端</title>
      <link>https://kyzy540.github.io/post/macos_v2ray_client/</link>
      <pubDate>Sat, 27 Jul 2024 07:45:32 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/macos_v2ray_client/</guid>
      <description>&lt;p&gt;主要介绍如何安装和配置v2ray，以及思路。如果只想要客户端配置，请跳至末尾&lt;/p&gt;
&lt;h2 id=&#34;v2ray介绍和服务端安装&#34;&gt;v2ray介绍和服务端安装&lt;/h2&gt;
&lt;p&gt;v2ray服务端安装之前写过一篇: &lt;a href=&#34;../vpnsetup&#34;&gt;《VPN Setup》&lt;/a&gt;。安装后记录关键配置&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;serverIp&lt;/strong&gt; (e.g. 20.163.126.10)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;serverPort&lt;/strong&gt; (e.g. 35555)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;uuid&lt;/strong&gt; (e.g. e2f30fgk-xxxx-xxxx-xxxx-xxxxxxxxxxxx)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;alertId&lt;/strong&gt; (e.g. 42)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;安装v2ray客户端&#34;&gt;安装v2ray客户端&lt;/h2&gt;
&lt;p&gt;v2ray客户端有很多，V2rayU/V2rayX/V2box等。要么多年无人维护，要么安装繁琐。到底还是开源社区维护的&lt;a href=&#34;https://github.com/v2fly/v2ray-core&#34;&gt;v2fly/v2ray-core&lt;/a&gt;最靠谱&lt;/p&gt;
&lt;p&gt;简单说，v2ray是一个支持vmess加密通讯服务。启动两个服务，一个在外网 (server)，一个在mac上 (client)。client向mac提供socket代理服务，和server通过vmess通讯&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://kyzy540.github.io/img/macos_v2ray_client/dataflow.png#center&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;注: 技术上说，图中client和server都是网络服务。mac将client的socket服务配置为系统代理才能起效&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;brew-install-v2ray&#34;&gt;brew install v2ray&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;brew&lt;/code&gt;是macOS的第三方包管理工具，可以用国内脚本安装 (github链接不稳定)。建议设阿里云镜像源。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/bin/zsh -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装v2ray&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install v2ray
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;全局代理配置&#34;&gt;全局代理配置&lt;/h2&gt;
&lt;p&gt;从最简单开始。这是所有流量都走代理的配置，保存到&lt;code&gt;$HOME/config.json&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;inbounds&lt;/strong&gt;: 用&lt;code&gt;socks&lt;/code&gt;协议监听&lt;code&gt;127.0.0.1:1080&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;outbounds&lt;/strong&gt;: 用&lt;code&gt;vmess&lt;/code&gt;协议转发流量，&lt;code&gt;vnext&lt;/code&gt;下是链接服务端的地址和认证&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;意味着client会将发往&lt;code&gt;127.0.0.1:1080&lt;/code&gt;的流量通过&lt;code&gt;vmess&lt;/code&gt;转发到服务端&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;inbounds&amp;#34;&lt;/span&gt;: [{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;1080&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// v2ray客户端监听端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;listen&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// 只允许本电脑链接
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;protocol&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;socks&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;settings&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;auth&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;noauth&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;udp&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;outbounds&amp;#34;&lt;/span&gt;: [{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;protocol&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;vmess&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;settings&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;vnext&amp;#34;&lt;/span&gt;: [{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;serverIp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// v2ray服务器IP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;serverPort&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// 服务端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;: [{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;uuid&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;alterId&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;alertId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;启动client&lt;/p&gt;</description>
    </item>
    <item>
      <title>zkcli</title>
      <link>https://kyzy540.github.io/post/zkcli/</link>
      <pubDate>Sat, 16 Sep 2023 21:06:11 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/zkcli/</guid>
      <description>&lt;p&gt;&lt;em&gt;2023-09-16&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;一个zookeeper cli客户端工具。基于&lt;code&gt;let-us-go/zkcli&lt;/code&gt;改进。原版地址 (内附安装教程): &lt;a href=&#34;https://github.com/let-us-go/zkcli&#34;&gt;https://github.com/let-us-go/zkcli&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;原版有个问题: &lt;code&gt;deleteall&lt;/code&gt;子命令不能递归删除zookeeper node。原因是 &lt;a href=&#34;https://github.com/let-us-go/zkcli/blob/master/core/cmd.go#L160&#34;&gt;代码&lt;/a&gt; 没实现递归删除&lt;/p&gt;
&lt;p&gt;鉴于仓库已超过1年不更新 (最后一次commit在2022-08-16)，我只好自己fork代码，增加了&lt;code&gt;deleteall&lt;/code&gt;的递归逻辑。安装命令&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install github.com/kyzy540/zkcli@latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;相较于zookeeper自带的cli工具 &lt;code&gt;zkCli.sh&lt;/code&gt;，这个go版本有3点优势&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;交互模式支持 &lt;code&gt;tab&lt;/code&gt; 自动提示&lt;/li&gt;
&lt;li&gt;支持 batch 模式执行命令&lt;/li&gt;
&lt;li&gt;方便安装配置，不依赖java&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;zkcli&lt;/code&gt;默认会读配置文件&lt;code&gt;$HOME/.config/zkcli.conf&lt;/code&gt;，可以避免每条命了都要输入冗长参数。配置文件参考 &lt;a href=&#34;https://github.com/let-us-go/zkcli/blob/master/zkcli.conf&#34;&gt;zkcli.conf&lt;/a&gt;。个人常用配置如下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;s 127.0.0.1:2181
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;P.S. 这是本人第一次写&lt;code&gt;go&lt;/code&gt;代码，如有问题还请见谅🙏&lt;/p&gt;</description>
    </item>
    <item>
      <title>分析一个Python MongoEngine的多层装饰器</title>
      <link>https://kyzy540.github.io/post/python_decorator/</link>
      <pubDate>Tue, 01 Aug 2023 16:48:08 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/python_decorator/</guid>
      <description>&lt;p&gt;在读MongoEngine文档时候看到了一段很牛逼的嵌套装饰器 &lt;a href=&#34;https://github.com/MongoEngine/mongoengine/blob/master/docs/guide/signals.rst&#34;&gt;@update_modified.apply&lt;/a&gt; ，核心代码如下&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt;(event):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&amp;#34;Signal decorator to allow use of callback functions as class decorators.&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;decorator&lt;/span&gt;(fn):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            event&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;connect(fn, sender&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cls)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; cls
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        fn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; apply
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; fn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; decorator
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@handler&lt;/span&gt;(signals&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pre_save)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;update_modified&lt;/span&gt;(sender, document):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    document&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;modified &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; datetime&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;utcnow()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@update_modified.apply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Record&lt;/span&gt;(Document):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    modified &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DateTimeField()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上述代码实现等同如下代码的功能，核心目的是让 &lt;code&gt;event/fn/cls&lt;/code&gt; 都可以组装。但……这个嵌套装饰器具体是如何生效的?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;signals&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pre_save&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;connect(update_modified, sender&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Record)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;参考 &lt;a href=&#34;https://www.zhihu.com/question/26930016&#34;&gt;《如何理解python装饰器》&lt;/a&gt; 可知道如下关系:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cls = Record&lt;/li&gt;
&lt;li&gt;fn = update_modified&lt;/li&gt;
&lt;li&gt;event = signals.pre_save&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;用 &lt;code&gt;handler&lt;/code&gt; 装饰 &lt;code&gt;update_modified&lt;/code&gt; 返回了装饰器&lt;code&gt;decorator&lt;/code&gt;，即一个组装的函数定义。将嵌套装饰器转换成单层装饰器&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;decorator&lt;/span&gt;(fn):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;(cls):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        signals&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;pre_save&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;connect(fn, sender&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cls)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; cls
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; apply
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; fn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;装饰器&lt;code&gt;decorator&lt;/code&gt;有点特别，它没直接返回内部函数&lt;code&gt;apply&lt;/code&gt;，而是将&lt;code&gt;apply&lt;/code&gt;赋值给传入函数&lt;code&gt;fn.apply&lt;/code&gt;后返回&lt;code&gt;fn&lt;/code&gt;。Python中函数是一等公民，即函数也是对象，&lt;code&gt;fn.apply = apply&lt;/code&gt; 就使用了这一特性&lt;/p&gt;</description>
    </item>
    <item>
      <title>扩展插件SwitchyOmega</title>
      <link>https://kyzy540.github.io/post/extend_switchyomega/</link>
      <pubDate>Thu, 30 Mar 2023 20:26:29 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/extend_switchyomega/</guid>
      <description>&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;
&lt;p&gt;SwitchyOmega是著名Chrome代理插件，&lt;a href=&#34;https://github.com/FelisCatus/SwitchyOmega&#34;&gt;源代码&lt;/a&gt;开源在GitHub，最近release是2018年8月&lt;/p&gt;
&lt;p&gt;它很健全，但算不上完美。截止写本文的2023年3月，GitHub仍有新issue提交，但开发者已经了无音讯&lt;/p&gt;
&lt;p&gt;所以当我想对它做改动，只能直接修改源代码，自己制作crx了&lt;/p&gt;
&lt;p&gt;需求是: 任意网页上，如果出现了如下span，SwitchyOmega可以一键载入代理服务器的地址和端口&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;span&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;proxy&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data-profileName&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;demo&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data-patterns&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;[&amp;#34;192.168.*&amp;#34;]&amp;#39;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  HTTP://172.168.1.1:8080
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#f92672&#34;&gt;span&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;工作可以拆分成几步&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;学习Chrome插件基本原理&lt;/li&gt;
&lt;li&gt;了解SwitchyOmega如何实现代理功能&lt;/li&gt;
&lt;li&gt;确认需求可否实现&lt;/li&gt;
&lt;li&gt;学习本地开发和调试&lt;/li&gt;
&lt;li&gt;着手实现&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我不想发布这个模改的插件，毕竟它仅对个人有用。所以到这就差不多了&lt;/p&gt;
&lt;p&gt;对了，我没前端经验，也没开发过Chrome插件&lt;/p&gt;
&lt;h2 id=&#34;基础知识&#34;&gt;基础知识&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.chrome.com/docs/extensions/mv3/getstarted/development-basics/&#34;&gt;Chrome Extension development basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.chrome.com/docs/extensions/reference/proxy/&#34;&gt;chrome.proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.runoob.com/angularjs/angularjs-scopes.html&#34;&gt;AngularJS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://coffeescript.org/&#34;&gt;CoffeeScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/FelisCatus/SwitchyOmega/blob/master/README.md#building-the-project&#34;&gt;Building the project&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在Chrome插件开发基础中主要了解4个点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;插件的主要构成。包含前端、后端、manifest、options&lt;/li&gt;
&lt;li&gt;插件前后端通信机制&lt;/li&gt;
&lt;li&gt;Chrome代理相关API&lt;/li&gt;
&lt;li&gt;SwitchyOmega如何基于配置调用Chrome API实现代理&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;SwitchyOmega代码 76.7% 是 CoffeeScript，用到了AngularJS框架。依赖 NodeJS/npm/Grunt/bower 构建 (build)&lt;/p&gt;
&lt;h2 id=&#34;switchyomega配置代理流程&#34;&gt;SwitchyOmega配置代理流程&lt;/h2&gt;
&lt;p&gt;下图展示了在SwitchyOmega 选项页面里创建一个 &amp;ldquo;情景模式&amp;rdquo; (代理配置) 是如何生效的&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://kyzy540.github.io/img/extend_switchyomega/switchy_omega_save_profile.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;首先，SwitchyOmega本身没实现代理功能。它实现了一套界面，让用户可以方便使用Chrome代理API。Chrome内部完成了具体的代理实现&lt;/p&gt;
&lt;p&gt;其次，SwitchyOmega在后台保存了一份核心数据结构&lt;code&gt;options&lt;/code&gt;，其会被转译并导入&lt;code&gt;chrome.proxy.settings&lt;/code&gt;。SwitchyOmega的前后端设计都围绕着维护&lt;code&gt;options&lt;/code&gt;数据结构设计。要实现点击span加载配置，重点就在于搞明白如何将页面数据导入&lt;code&gt;options&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;本地开发和调试&#34;&gt;本地开发和调试&lt;/h2&gt;
&lt;h3 id=&#34;构建&#34;&gt;构建&lt;/h3&gt;
&lt;p&gt;开发的第一步，是走通原有的构建流程，在Chrome里试用正常。如果参考构建文档，会在 &lt;code&gt;npm run deps&lt;/code&gt; 阶段遇到如下报错&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;bower angular-spectrum-colorpicker#~1.3.5      ECMDERR Failed to execute &amp;ldquo;git ls-remote &amp;ndash;tags &amp;ndash;heads &lt;a href=&#34;https://github.com/Jimdo/angular-spectrum-colorpicker.git%22&#34;&gt;https://github.com/Jimdo/angular-spectrum-colorpicker.git&amp;quot;&lt;/a&gt;, exit code of #128 remote: Repository not found. fatal: Authentication failed for &amp;lsquo;&lt;a href=&#34;https://github.com/Jimdo/angular-spectrum-colorpicker.git/&#39;&#34;&gt;https://github.com/Jimdo/angular-spectrum-colorpicker.git/&#39;&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>VPN Setup</title>
      <link>https://kyzy540.github.io/post/vpnsetup/</link>
      <pubDate>Tue, 18 Oct 2022 09:16:11 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/vpnsetup/</guid>
      <description>&lt;h2 id=&#34;v2ray&#34;&gt;V2Ray&lt;/h2&gt;
&lt;p&gt;关于V2Ray介绍，请参考 &lt;a href=&#34;https://itlanyan.com/v2ray-tutorial/&#34;&gt;V2Ray简介和搭建教程&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;文章写得很好，我仅做点补充: 文中的安装脚本 (goV2.sh) 在2022年11月7日报错。我仅针对报错修改了一下脚本，可自取&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://raw.githubusercontent.com/kyzy540/blogdraft/main/static/scripts/goV2.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chmod +x goV2.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo ./goV2.sh --version v5.1.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;改动点如下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;删除&lt;code&gt;v2ctl&lt;/code&gt; 相关代码，&lt;code&gt;v2ctl&lt;/code&gt; 在v2ray v5.1.0 中被移除&lt;/li&gt;
&lt;li&gt;修改&lt;code&gt;v2ray.service&lt;/code&gt;启动命令，增加了&lt;code&gt;run&lt;/code&gt;子命令和 &lt;code&gt;v2ray.vmess.aead.forced=false&lt;/code&gt; 环境变量&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;该脚本集成了配置文件生成，位置在&lt;code&gt;/etc/v2ray/config.json&lt;/code&gt;。其中的uuid和端口均自动生成。安装完成后参考配置放行端口，启用服务&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ubuntu 20.02&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;port&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;grep port /etc/v2ray/config.json | awk &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; | cut -d, -f1&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo ufw allow &lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;port&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;/tcp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#启用 v2ray服务&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl enable v2ray
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl start v2ray
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意云实例的防火墙也要放行配置中的端口(TCP协议)&lt;/p&gt;
&lt;h3 id=&#34;诊断v2ray代理&#34;&gt;诊断V2Ray代理&lt;/h3&gt;
&lt;p&gt;在未配置 &lt;code&gt;v2ray.vmess.aead.forced=false&lt;/code&gt; 环境变量时V2Ray代理虽然能链接，但Safari打不开任何网页，报错类似&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;safari cannot open the page cannot establish a secure connection&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;诊断的关键是在 &lt;code&gt;/etc/v2ray/config.json&lt;/code&gt; 加入日志配置，并重启v2ray服务&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;access&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/var/www/v2ray/access.log&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;error&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/var/www/v2ray/error.log&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;loglevel&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;info&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;inbounds&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;重启后再测试，看到日志有如下&lt;/p&gt;</description>
    </item>
    <item>
      <title>ERROR: Win32Bridge.Server.exe</title>
      <link>https://kyzy540.github.io/post/windows_bridge_server_error/</link>
      <pubDate>Thu, 28 Apr 2022 09:43:39 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/windows_bridge_server_error/</guid>
      <description>&lt;p&gt;某次系统升级后一登录就报错&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Windows cannot find &amp;lsquo;C:\Program Files\Microsoft.549981C3F5F10_4.2203.4603.0_x64&amp;hellip;\Win32Bridge.Server.exe&amp;rsquo;. Make sure you typed the name correctly, and the try again.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单来说就是Cortana (小娜)的问题，参考下图在配置里重置就好&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;img&#34; loading=&#34;lazy&#34; src=&#34;https://kyzy540.github.io/img/windows/bridge_server_error.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://answers.microsoft.com/en-us/windows/forum/all/win32bridge-server-problem-cant-find/5377d9bc-3e66-415d-b9c1-48968747ea1d?auth=1&#34;&gt;参考链接&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>微软好终端</title>
      <link>https://kyzy540.github.io/post/windows_terminal/</link>
      <pubDate>Thu, 18 Jun 2020 19:05:59 +0800</pubDate>
      <guid>https://kyzy540.github.io/post/windows_terminal/</guid>
      <description>&lt;p&gt;Windows发展到今日，已非复吴下阿蒙。被诟病多年的&amp;quot;终端难用&amp;quot;问题已经有了不错的解决方案。本文分享几个让我受益颇多的工具&lt;/p&gt;
&lt;p&gt;在介绍工具前，读者应了解几点知识:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;掌握一种常用SHELL，例如bash,&lt;/li&gt;
&lt;li&gt;知道终端和SHELL的区别。如果不了解，请读&lt;a href=&#34;https://www.hanselman.com/blog/WhatsTheDifferenceBetweenAConsoleATerminalAndAShell.aspx&#34;&gt;博文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;知道cygwin，以及它和Linux/Mac下终端的区别&lt;/li&gt;
&lt;li&gt;知道Gnu和Linux/Unix的区别&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;powershell&#34;&gt;Powershell&lt;/h2&gt;
&lt;p&gt;Powershell早在Windows7时代就被捆绑在系统内，在当代Windows电脑上基本都能用。我不推荐Powershell，但有时条件受限，不得不依仗它，例如&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只能用早期操作系统，例如Windows7&lt;/li&gt;
&lt;li&gt;没有Administrator权限，无法添加/关闭系统功能&lt;/li&gt;
&lt;li&gt;机器性能贫瘠，跑cygwin都迟钝&lt;/li&gt;
&lt;li&gt;SDK或build环境局限于Windows&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Powershell本身并不差，很多时候用户只因没法在其中使用grep/less/vim等命令，而抱怨不已。但其实这问题有解&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/bmatzelle/gow/wiki&#34;&gt;GOW&lt;/a&gt; (Gnu On Windows)囊获了100+个常用Gnu命令。它开源、免费，只包含一堆EXE文件，大小18MB左右。我日常用到的Gnu命令都在其中&lt;/p&gt;
&lt;p&gt;想找出java文件中包含Log关键字最多的前3名？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:\Users&amp;gt; grep -c Log *.java | sort {[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]$_.split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:&amp;#34;&lt;/span&gt;)[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]} -D | head -n &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.java&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;B.java&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C.java&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中grep和head来自GOW，sort来自Powershell。如何确定这些命令的来源？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:\Users&amp;gt; which head
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C: \Program Files (x86)\Gow\bin\grep.EXE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:\Users&amp;gt; which head
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C: \WINDOWS\system32\sort.EXE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有了GOW，Powershell已经能应付简单的终端任务&lt;/p&gt;
&lt;p&gt;另外，Powershell支持history，用户可以很方便地用ctrl+r回溯历史命令，这是cmd所不具备的&lt;/p&gt;
&lt;h3 id=&#34;可选工具&#34;&gt;可选工具&lt;/h3&gt;
&lt;p&gt;下面介绍的工具可能不适合所有人，只是我比较常用，不装也无妨&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chocolatey.org/&#34;&gt;choco&lt;/a&gt; 是Windows下包管理工具，运行在终端内，类似apt和yum。推荐给爱尝鲜新软件的读者。以安装GOW为例&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bat&#34; data-lang=&#34;bat&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;choco install gow
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/vors/ZLocation&#34;&gt;ZLocation&lt;/a&gt; 类似autojump，是一款目录导航工具，可以理解为cd命令的补充。它能让用户在常用目录间左右横跳&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/BurntSushi/ripgrep&#34;&gt;ripgrep&lt;/a&gt; 是更好用的grep，用于文本搜索。我认为其性能和易用性都优于grep。例如下面命令会递归搜索当前目录下 .java和 .properties 文件，找 Log 关键词。rg会自动排查隐藏文件和二进制文件 (.class和.jar)，搜索效率很高&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bat&#34; data-lang=&#34;bat&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rg -tjava Log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/stedolan/jq&#34;&gt;jq&lt;/a&gt; 是个JSON解析工具，对于经常写脚本解析JSON数据的朋友有帮助&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
